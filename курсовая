#include <iostream>
#include <iomanip>
#include <string>
#include <limits>
#include <locale>

using namespace std;

// Функция для отображения главного меню
int show_menu() {
    int choice{};

    cout << "КАЛЬКУЛЯТОР НАЛОГОВОЙ НАГРУЗКИ \n";
    cout << "1. Ввести данные и рассчитать\n";
    cout << "2. Показать справку по системам налогообложения\n";
    cout << "3. О программе\n";
    cout << "4. Выход\n";
    cout << "Выберите пункт меню (1-4): ";

    return choice;
}

// Функция для отображения справки
void show_help() {
    cout << "СПРАВКА ПО СИСТЕМАМ НАЛОГООБЛОЖЕНИЯ \n";
    cout << "1. ОСНО (Общая система налогообложения):\n";
    cout << "   - Налог на прибыль: 20% от (выручка - расходы - ФОТ)\n";
    cout << "   - Подходит для крупного бизнеса\n\n";

    cout << "2. УСН 6% (Упрощённая система, доходы):\n";
    cout << "   - Налог: 6% от выручки\n";
    cout << "   - Расходы не учитываются\n\n";

    cout << "3. УСН 15% (Упрощённая система, доходы-расходы):\n";
    cout << "   - Налог: 15% от (выручка - расходы)\n";
    cout << "   - ФОТ не вычитается из налоговой базы\n";
    cout << "\nДля продолжения нажмите Enter...";
    cin.ignore();
    cin.get();
}

// Функция для отображения информации о программе
void show_about() {
    cout << "О ПРОГРАММЕ \n";
    cout << "Калькулятор налоговой нагрузки v1.0\n";
    cout << "Программа рассчитывает налоговую нагрузку\n";
    cout << "для разных систем налогообложения\n";
    cout << "\nДля продолжения нажмите Enter...";
    cin.ignore();
    cin.get();
}

// Функция для ввода данных и расчёта
void calculate_tax() {
    double выручка, расходы, фот;
    string system;

    cout << "ВВОД ДАННЫХ ДЛЯ РАСЧЁТА \n";

    // Ввод выручки с проверкой
    while (true) {
        cout << "Введите выручку (положительное число): ";
        cin >> выручка;

        if (cin.fail() || выручка < 0) {
            cin.clear();
            cin.ignore(numeric_limits<streamsize>::max(), '\n');
            cout << "Ошибка: введите корректное число!\n";
        }
        else {
            break;
        }
    }

    // Ввод расходов с проверкой
    while (true) {
        cout << "Введите расходы (от 0 до " << выручка << "): ";
        cin >> расходы;

        if (cin.fail() || расходы < 0 || расходы > выручка) {
            cin.clear();
            cin.ignore(numeric_limits<streamsize>::max(), '\n');
            cout << "Ошибка: расходы должны быть от 0 до " << выручка << "!\n";
        }
        else {
            break;
        }
    }

    // Ввод ФОТ с проверкой
    while (true) {
        cout << "Введите фонд оплаты труда (неотрицательное число): ";
        cin >> фот;

        if (cin.fail() || фот < 0) {
            cin.clear();
            cin.ignore(numeric_limits<streamsize>::max(), '\n');
            cout << "Ошибка: введите корректное число!\n";
        }
        else {
            break;
        }
    }

    // Ввод системы налогообложения с проверкой
    while (true) {
        cout << "Выберите систему налогообложения:\n";
        cout << "1. ОСНО (Общая система)\n";
        cout << "2. УСН 6% (Доходы)\n";
        cout << "3. УСН 15% (Доходы минус расходы)\n";
        cout << "Ваш выбор (1-3): ";

        int sys_choice;
        cin >> sys_choice;

        if (cin.fail() || sys_choice < 1 || sys_choice > 3) {
            cin.clear();
            cin.ignore(numeric_limits<streamsize>::max(), '\n');
            cout << "Ошибка: введите число от 1 до 3!\n";
        }
        else {
            switch (sys_choice) {
            case 1: system = "ОСНО"; break;
            case 2: system = "УСН_6"; break;
            case 3: system = "УСН_15"; break;
            }
            break;
        }
    }

    // Расчёт налога
    double tax = 0;

    if (system == "ОСНО") {
        tax = (выручка - расходы - фот) * 0.20;
    }
    else if (system == "УСН_6") {
        tax = выручка * 0.06;
    }
    else if (system == "УСН_15") {
        tax = (выручка - расходы) * 0.15;
    }

    // Расчёт чистой прибыли и налоговой нагрузки
    double netProfit = выручка - расходы - фот - tax;
    double taxLoad = (выручка == 0) ? 0 : (tax / выручка) * 100;

    // Вывод результатов
    cout << fixed << setprecision(2);
    cout << "РЕЗУЛЬТАТЫ РАСЧЁТА \n";
    cout << "Система налогообложения: " << system << endl;
    cout << "Выручка: " << выручка << " руб.\n";
    cout << "Расходы: " << расходы << " руб.\n";
    cout << "ФОТ: " << фот << " руб.\n";
    cout << "Налог на прибыль: " << tax << " руб.\n";
    cout << "Чистая прибыль: " << netProfit << " руб.\n";
    cout << "Налоговая нагрузка: " << taxLoad << "%\n";

    cout << "Для продолжения нажмите Enter...";
    cin.ignore();
    cin.get();
}

int main() {
    setlocale(LC_ALL, "Russian");

    int choice;
    bool running = true;

    while (running) {
        // Показывается меню
        choice = show_menu();

        // Считывается выбор пользователя
        cin >> choice;

        if (cin.fail()) {
            cin.clear();
            cin.ignore(numeric_limits<streamsize>::max(), '\n');
            cout << "Ошибка: введите число от 1 до 4!\n";
            cout << "Для продолжения нажмите Enter...";
            cin.get();
            continue;
        }

        // Обработка выбора
        switch (choice) {
        case 1:
            calculate_tax();
            break;

        case 2:
            show_help();
            break;

        case 3:
            show_about();
            break;

        case 4:
            cout << "\nВыход из программы...\n";
            running = false;
            break;

        default:
            cout << "Ошибка: введите число от 1 до 4!\n";
            cout << "Для продолжения нажмите Enter...";
            cin.ignore();
            cin.get();
            break;
        }
    }

    cout << "Нажмите Enter для выхода...";
    cin.ignore();
    cin.get();

    return 0;
}
